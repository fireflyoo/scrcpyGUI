<html>
<head>
    <HTA:APPLICATION SCROLL="yes" SYSMENU="no" />
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta http-equiv=content-type content='charset=utf-8' />
    <meta http-equiv=msthemecompatible content=yes />
    <title>HTA Buttons</title>
    <script language="JScript">
    window.resizeTo(450,620);

    function exec(command){
        var shell = new ActiveXObject("WScript.Shell"),
        exec = shell.Exec(command);
        return { Out: exec.StdOut.ReadAll(),
		         Err: exec.StdErr.ReadAll()
				 }
    }
	function getOptions() {
		var result=[];
		for(var i=0;i<options.length;i++){
			if(options[i].checked)
				result.push(options[i].value)
		} 
		return " "+result.join(" ")
	}
	function wireless() {
		var result=exec('scrcpy --tcpip='+IP.value+getOptions())
		out.innerText=result.Out
		err.innerText=result.Err
		}
	function wifiPair() {
		var result=exec('adb pair '+IP.value)
		out.innerText=result.Out
		err.innerText=result.Err
	}

	function refreshDevicesList() {
		var ls_devices=exec("adb devices").Out.split("\r\n").slice(1,-2).map(function (line){return line.split(/\s/)[0]})
		devices.options.length=0;
		ls_devices.forEach(function(item){
			devices.add(new Option(item,item))
		})
		if(devices.options.length!=0)devices.options[0].selected = true
	}
	function fromUsbToWifi() {
		var result=exec('scrcpy -d --tcpip'+getOptions())
		out.innerText=result.Out
		err.innerText=result.Err
	}

	window.onload = function () {
		refreshDevicesList();
		refresh.onclick=refreshDevicesList
	// /*Debug*/	out.innerText=ls_devices+ls_devices.length
		close_window.onclick=function () {
			window.close();
		}
		usb2wifi.onclick=fromUsbToWifi;
		del.onclick=function() {
			var result=exec('adb disconnect '+devices.value)
			refreshDevicesList()
			out.innerText=result.Out
			err.innerText=result.Err
		}
		otg.onclick=function() {
			var result=exec('scrcpy -s'+devices.value+' --otg')
			refreshDevicesList()
			out.innerText=result.Out
			err.innerText=result.Err
		}
		launch.onclick=function() {
			var result=exec('scrcpy -s '+devices.value+getOptions())
			out.innerText=result.Out
			err.innerText=result.Err
		}
		pair_start.onclick=wifiPair
		start.onclick=wireless;
	}
    </script>
    <style>
        *{color:gray}
		#err{color:red}
		h2{font-size:20px}
		select{width:250px}
        button{background-color:black; border-color:white}
    </style>
</head>
<body bgcolor="black">
    <h2>Scrcpy</h2>   
    <hr>
    <button id="usb2wifi">一键无线</button>
    <button id="close_window">close</button>
    <hr>
	<br>
	<h3>Connect from IP or Pair from Wifi</h3>
    <input type="text" id="IP"  placeholder="IP:Port [PairCode]">
    <button id="start">Start</button><button id="pair_start">Pair</button><br><br>
	<h3>Connect from Device</h3>
	<select id="devices" size=5 ><select><br>
	<button id="launch">Launch</button>
	<button id="refresh">Refresh</button>
	<button id="del">Delete</button>
	<button id="otg" title="Only work with USB-Connected">OTG</button>
	<fieldset>
    <legend>配置</legend>
    <input type="checkbox" name="options" value="--turn-screen-off" checked><lable>自动息屏</lable>
    <input type="checkbox" name="options" value="--stay-awake" checked><lable title="只在USB有线下有效">保持唤醒</lable>
	<input type="checkbox" name="options" value="--power-off-on-close" checked><lable title="">关后息屏</lable>
    <input type="checkbox" name="options" value="--always-on-top" checked><lable title="--always-on-top">窗口置顶</lable>
	<br>
	<input type="checkbox" name="options" value="--disable-screensaver" checked><lable title="--disable-screensaver">禁止屏保</lable>
	<input type="checkbox" name="options" value="--no-audio"><lable title="--no-audio">禁投音频</lable>
    <input type="checkbox" name="options" value="--no-control"><lable title="--no-control">禁止操控</lable>
    </fieldset>
    <pre id="out"></pre>
	<pre id="err"></pre>
</body>
</html>
